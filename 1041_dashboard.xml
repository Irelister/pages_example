<dashboard>
  <label>MITRE T1041 - Exfiltration Over Command and Control Channel (Zeek/Corelight)</label>
  <description>Detect possible data exfiltration activities over C2 channels using Zeek/Corelight logs.</description>
  <row>
    <panel>
      <title>Large Data Transfers via HTTP</title>
      <chart>
        <search>
          <query>index=zeek sourcetype=zeek:http 
| where method="POST" 
| stats sum(resp_body_len) as total_bytes_sent by id_orig_h, id_resp_h, uri 
| where total_bytes_sent &gt; 1000000</query>
        </search>
        <option name="charting.chart">column</option>
      </chart>
    </panel>

    <panel>
      <title>Suspicious DNS Tunneling Behavior</title>
      <chart>
        <search>
          <query>index=zeek sourcetype=zeek:dns 
| where query_type_name="TXT" OR query_length &gt; 100 
| stats count by id_orig_h, query</query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Consistent Large Transfers via HTTPS</title>
      <chart>
        <search>
          <query>index=zeek sourcetype=zeek:conn 
| where service="ssl" AND orig_bytes &gt; 5000000 
| stats count by id_orig_h, id_resp_h, orig_bytes, dest_port</query>
        </search>
        <option name="charting.chart">line</option>
      </chart>
    </panel>

    <panel>
      <title>Unusual File Uploads to External IPs</title>
      <chart>
        <search>
          <query>index=zeek sourcetype=zeek:files 
| search fuid=* 
| lookup local=true geoip ip as id_resp_h 
| where country != "" AND country != "United States" 
| stats count by id_orig_h, id_resp_h, filename, mime_type</query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Uncommon Protocols with High Data Volume</title>
      <chart>
        <search>
          <query>index=zeek sourcetype=zeek:conn 
| where NOT service IN ("http", "dns", "ssl") AND orig_bytes &gt; 1000000 
| stats sum(orig_bytes) as exfil_volume by id_orig_h, id_resp_h, service</query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>
</dashboard>
